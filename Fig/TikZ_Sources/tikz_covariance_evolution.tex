\begin{tikzpicture}[
	smallnode/.style={circle, draw, minimum size=3mm, inner sep=0pt},
	r_smallnode/.style={circle, draw=red, minimum size=3mm, inner sep=0pt},
	g_smallnode/.style={circle, draw=mygreen, minimum size=3mm, inner sep=0pt},
	r_hatnode/.style={
		circle, draw=red, pattern=north east lines, pattern color=red,
		minimum size=3mm, inner sep=0pt},
	g_hatnode/.style={
		circle, draw=mygreen, pattern=north east lines, pattern color=mygreen,
		minimum size=3mm, inner sep=0pt},
	every path/.style={->, thick},
	x=1.4cm, y=1.2cm
	]
	
	% ROW j = 0 (y=3)
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k-3}^0\)}] (P00) at (1,3) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k-2}^1\)}] (P11) at (2,3) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k-1}^2\)}] (P22) at (3,3) {};
	\node[g_hatnode, label={[label distance=-2pt]above:\(\bP_k^3\)}] (P33) at (4,3) {};
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k+1}^0\)}] (P44) at (5,3) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+2}^1\)}] (P55) at (6,3) {};
	
	% ROW j = 1 (y=2)
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k-2}^0\)}] (P10) at (2,2) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k-1}^1\)}] (P21) at (3,2) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_k^2\)}] (P32) at (4,2) {};
	\node[g_hatnode, label={[label distance=-2pt]above:\(\bP_{k+1}^3\)}] (P43) at (5,2) {};
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k+2}^0\)}] (P54) at (6,2) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+3}^1\)}] (P65) at (7,2) {};
	
	
	% ROW j = 2 (y=1)
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k-1}^0\)}] (P20) at (3,1) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_k^1\)}] (P31) at (4,1) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+1}^2\)}] (P42) at (5,1) {};
	\node[g_hatnode, label={[label distance=-2pt]above:\(\bP_{k+2}^3\)}] (P53) at (6,1) {};
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k+3}^0\)}] (P64) at (7,1) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+4}^1\)}] (P75) at (8,1) {};
	
	% ROW j = 3 (y=0)
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_k^0\)}] (P30) at (4,0) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+1}^1\)}] (P41) at (5,0) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+2}^2\)}] (P52) at (6,0) {};
	\node[g_hatnode, label={[label distance=-2pt]above:\(\bP_{k+3}^3\)}] (P63) at (7,0) {};
	\node[r_hatnode, label={[label distance=-2pt]above:\(\bP_{k+4}^0\)}] (P74) at (8,0) {};
	\node[smallnode, label={[label distance=-2pt]above:\(\bP_{k+5}^1\)}] (P85) at (9,0) {};
	
	
	% ARROWS
	\draw (P00) -- (P11);
	\draw (P11) -- (P22);
	\draw (P22) -- (P33);
	\draw (P22) -- (P33);
	
	\draw (P44) -- (P55);
	\draw[dashed,->] (P55) -- ++(1,0);
	
	\draw (P10) -- (P21);
	\draw (P21) -- (P32);
	\draw (P32) -- (P43);
	\draw (P54) -- (P65);
	\draw[dashed,->] (P65) -- ++(1,0);
	
	
	\draw (P20) -- (P31);
	\draw (P31) -- (P42);
	\draw (P42) -- (P53);
	\draw (P64) -- (P75);
	\draw[dashed,->] (P75) -- ++(1,0);
	
	\draw (P30) -- (P41);
	\draw (P41) -- (P52);
	\draw (P52) -- (P63);
	
	\draw (P74) -- (P85);
	\draw[dashed,->] (P85) -- ++(1,0);
	
	% Dashed box around column k (x=4)
	\draw[dashed, thick, rounded corners] (3.6,-0.5) rectangle (4.4,3.7);
	
	% Top axis labels
	\node at (0, 4.3) {\scriptsize \(\cdots\)};
	\node at (1, 4.3) {\scriptsize \(k-3\)};
	\node at (2, 4.3) {\scriptsize \(k-2\)};
	\node at (3, 4.3) {\scriptsize \(k-1\)};
	\node (knode) at (4, 4.3) {\scriptsize \(k\)};
	\node at (5, 4.3) {\scriptsize \(k+1\)};
	\node at (6, 4.3) {\scriptsize \(k+2\)};
	\node at (7, 4.3) {\scriptsize \(k+3\)};
	\node at (8, 4.3) {\scriptsize \(k+4\)};
	\node at (9, 4.3) {\scriptsize \(\cdots\)};
	
	% Wiggly arrow from label to top edge of dashed box
	\draw[->, thick, decorate, decoration={snake, amplitude=0.25mm, segment length=2.5mm}]
	(knode.south) -- (4, 3.8);
	
	% Legend box (top right)
	%\begin{scope}[shift={(6.5,2.5)}]
	%    \node[r_smallnode] (r) at (0,0) {};
	%    \node[anchor=west] at (0.4,0) {\scriptsize Initialized matrix \(\bP_k^0\)};
	%
	%    \node[g_smallnode] (g) at (0,-0.8) {};
	%    \node[anchor=west] at (0.4,-0.8) {\scriptsize Most propagated matrix \(\bP_k^3\)};
	%\end{scope}
	
\end{tikzpicture}